# 11.14总结-文件函数，文件格式，调试器

[TOC]



## 	1.文件函数

### 			`fopen`函数

​	mode： r+读写文件，文件指针从文件头部开始

​				    a+从文件结尾开始，而且不可以往前覆写

​					w重新建立文件、

​					t文件形式打开------b二进制形式打开

### 		其他文件读写函数

 `fwrite,fread`函数`：二进制形式写入读出

其他`fgetc,fputc,fgets,fputs,fscanf,fprintf`等等文本形式写入写出，`ascii`码形式储存在文件中。

##  	2.文件格式

​		Linux下会忽略`fopen`的b或t格式，这是由于历史原因（c语言对Linux的适配）操作系统不同换行符不同，windows下为双字节/r/n

**我们程序中，经常看到的文本方式打开文件和二进制方式打开文件仅仅体现在换行符的处理上。**

而Linux下与c语言相同，为单字节\n；这导致Windows下会进行转换，也就导致转换过程中可能会出现文件不完整，文件冗杂的问题，因此建议Windows下`fopen`用二进制形式打开写入，不会导致之后的格式切换问题。同时Windows切换的问题会使文件变大。

​		大多数操作系统可以实现二进制和文本格式的转换，而Windows的`txt`格式更是记事本用`ASCII`码打开，所以打开会出现乱码

​		存储方式不同，二进制为原封不动存储，文本格式会经过转换，比如 ‘65’ 这个数字二进制格式保存为int格式是四个字节，而文本形式为ASCII码格式，存入时会拆分为 ‘6’ 和  ’5‘  即两个字节，因此数据库构建时多用二进制格式，文件更小。

## 	1.2.联系：

​		通过对1.2.两点的深入学习，可以得到很多好用的写入写出方式，比如`fgetc`,`fputc`与`while`的搭配使用，实现文本格式输入输出，而`fgets`函数可以通过程序进行优化，去掉结尾换行符的问题。`fwrite`适合结构体写入。

## 	3.调试器

​		`ASAN`以影子内存形式直观展示内存使用的问题

![Image_1699976017452](http://o5orde-oss.oss-cn-beijing.aliyuncs.com/Image_1699976017452.jpg)



如图，`asan`依靠影子内存可以让你直观的知道内存的使用，（1为错误类型，3为错误地方，之后为内存的使用情况红框6处就是内存溢出的地方），中括号指明了你内存溢出到哪个位置

正常没有问题的程序`valgrind`仍然会有日志，而`asan`不会有任何日志产生![20231114233713](http://o5orde-oss.oss-cn-beijing.aliyuncs.com/20231114233713.png)

如图`valgrind`不会那么直观，会告诉你所有错误的位置以及错误的数量，但是也因此，报错的地方不一定是真的有问题的地方，你可能需要找到报错的根本原因

另一方面`valgrind`选项功能多，要深入使用才能更好地掌握，而`asan`相对来说更好上手一些

原理：valgrind构造虚拟cpu对地址进行筛查，检验合法性，而asan通过构造影子内存，监测影子内存进行bug筛查

### valgrind核心原理

核心 将代码交给所选工具。该工具会添加自己的 检测代码，并将结果交还给核心， 协调此仪器的持续执行 法典。

添加的检测代码量在以下方面差异很大 工具。在规模的一端，Memcheck 添加代码以检查每个 内存访问和计算的每个值， 使其运行速度比本机慢 10-50 倍。 在光谱的另一端，称为 Nulgrind 的最小工具， 根本没有添加任何仪器，总共“仅”导致大约 4 次 减速。

当检测到错误时， 将其与旧报告进行比较，以查看它是否重复以防止你被过量的错误报告淹没



参考文献：[C中fopen的mode参数中b的使用区别](https://blog.csdn.net/airekans/article/details/6928537)

​					[库函数](https://www.runoob.com/cprogramming/c-function-fopen.html)

​					[文件形式](https://blog.csdn.net/guyue6670/article/details/6681037)

​					[asan影子内存](https://blog.csdn.net/weixin_43708622/article/details/117966519)

​				    [文件写入写出函数](https://blog.csdn.net/shulianghan/article/details/117376038)